<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Login Portal - Modern Edition</title>
  <style>
    :root{
      --bg-base:#0f0f23;
      --bg-overlay:rgba(15,15,35,.75);
      --text:#e5e7eb;
      --text-muted:#9ca3af;
      --card:rgba(17,24,39,.65);
      --card-border:rgba(255,255,255,.08);
      --input-bg:rgba(31,41,55,.45);
      --input-border:rgba(255,255,255,.12);
      --input-focus:rgba(99,102,241,.35);
      --shadow-lg:0 25px 50px -12px rgba(0,0,0,.45);
      --shadow-glow:0 0 60px rgba(99,102,241,.25);
      --primary-from:#6366f1;
      --primary-to:#8b5cf6;
      --success:#10b981;
      --danger:#ef4444;
      --accent1:rgba(99,102,241,.15);
      --accent2:rgba(236,72,153,.12);
      --accent3:rgba(20,184,166,.10);
    }

    [data-theme="light"]{
      --bg-base:#f9fafb;
      --bg-overlay:rgba(249,250,251,.85);
      --text:#111827;
      --text-muted:#6b7280;
      --card:rgba(255,255,255,.75);
      --card-border:rgba(0,0,0,.06);
      --input-bg:rgba(255,255,255,.55);
      --input-border:rgba(0,0,0,.08);
      --input-focus:rgba(99,102,241,.25);
      --shadow-lg:0 25px 50px -12px rgba(0,0,0,.12);
      --shadow-glow:0 0 60px rgba(99,102,241,.15);
      --accent1:rgba(99,102,241,.08);
      --accent2:rgba(236,72,153,.06);
      --accent3:rgba(20,184,166,.06);
    }

    *{
      box-sizing:border-box;
      margin:0;
      padding:0;
    }

    body{
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      color:var(--text);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:20px;
      background:var(--bg-base);
      position:relative;
      overflow:hidden;
      transition: background .3s ease;
    }

    /* Animated gradient background */
    .bg-gradient{
      position:fixed;
      inset:0;
      background:
        radial-gradient(circle at 20% 30%, var(--accent1) 0%, transparent 50%),
        radial-gradient(circle at 80% 20%, var(--accent2) 0%, transparent 50%),
        radial-gradient(circle at 40% 80%, var(--accent3) 0%, transparent 50%);
      opacity:1;
      animation: gradientShift 20s ease infinite;
    }

    @keyframes gradientShift{
      0%, 100%{ transform: translate(0,0) scale(1); }
      33%{ transform: translate(30px,-20px) scale(1.05); }
      66%{ transform: translate(-20px,30px) scale(.95); }
    }

    /* Floating orbs */
    .orb{
      position:fixed;
      border-radius:50%;
      filter:blur(80px);
      opacity:.4;
      pointer-events:none;
      mix-blend-mode:screen;
      animation: float 15s ease-in-out infinite;
    }
    .orb.o1{
      width:600px;
      height:600px;
      background:linear-gradient(135deg, #6366f1, #8b5cf6);
      top:-200px;
      left:-200px;
      animation-delay:0s;
    }
    .orb.o2{
      width:500px;
      height:500px;
      background:linear-gradient(135deg, #ec4899, #f43f5e);
      bottom:-150px;
      right:-150px;
      animation-delay:-5s;
    }
    .orb.o3{
      width:450px;
      height:450px;
      background:linear-gradient(135deg, #14b8a6, #06b6d4);
      top:50%;
      right:10%;
      animation-delay:-10s;
    }

    @keyframes float{
      0%, 100%{ transform: translate(0,0) rotate(0deg); }
      33%{ transform: translate(30px,-30px) rotate(5deg); }
      66%{ transform: translate(-30px,30px) rotate(-5deg); }
    }

    /* Grid pattern overlay */
    .grid-overlay{
      position:fixed;
      inset:0;
      background-image:
        linear-gradient(rgba(99,102,241,.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(99,102,241,.03) 1px, transparent 1px);
      background-size: 60px 60px;
      opacity:.5;
      pointer-events:none;
    }

    .container{
      width:100%;
      max-width:440px;
      position:relative;
      z-index:10;
    }

    /* Theme toggle */
    .theme-toggle{
      position:absolute;
      top:-60px;
      right:0;
      background:var(--card);
      border:1px solid var(--card-border);
      border-radius:50px;
      padding:8px;
      backdrop-filter:blur(20px);
      -webkit-backdrop-filter:blur(20px);
      box-shadow:var(--shadow-lg);
      display:flex;
      gap:4px;
      cursor:pointer;
      transition: all .3s ease;
    }
    .theme-toggle:hover{
      transform:translateY(-2px);
      box-shadow:var(--shadow-lg), var(--shadow-glow);
    }
    .theme-btn{
      width:36px;
      height:36px;
      border-radius:50px;
      border:none;
      background:transparent;
      color:var(--text-muted);
      cursor:pointer;
      display:grid;
      place-items:center;
      transition: all .3s ease;
      position:relative;
    }
    .theme-btn.active{
      background:linear-gradient(135deg, var(--primary-from), var(--primary-to));
      color:#fff;
      box-shadow: 0 4px 12px rgba(99,102,241,.35);
    }
    .theme-btn svg{
      width:18px;
      height:18px;
    }

    .card{
      background:var(--card);
      border:1px solid var(--card-border);
      border-radius:32px;
      padding:40px 36px;
      backdrop-filter:blur(30px);
      -webkit-backdrop-filter:blur(30px);
      box-shadow:var(--shadow-lg), var(--shadow-glow);
      position:relative;
      overflow:hidden;
      animation: cardEntry .6s cubic-bezier(.34,1.56,.64,1);
    }

    @keyframes cardEntry{
      from{
        opacity:0;
        transform: translateY(30px) scale(.95);
      }
      to{
        opacity:1;
        transform: translateY(0) scale(1);
      }
    }

    /* Shimmer effect on card */
    .card::before{
      content:'';
      position:absolute;
      top:-50%;
      left:-50%;
      width:200%;
      height:200%;
      background:linear-gradient(
        45deg,
        transparent 30%,
        rgba(255,255,255,.08) 50%,
        transparent 70%
      );
      animation: shimmer 8s infinite;
      pointer-events:none;
    }

    @keyframes shimmer{
      0%{ transform: translateX(-100%) translateY(-100%) rotate(45deg); }
      100%{ transform: translateX(100%) translateY(100%) rotate(45deg); }
    }

    .header{
      text-align:center;
      margin-bottom:32px;
      position:relative;
      z-index:1;
    }

    .logo-wrapper{
      display:inline-flex;
      margin-bottom:20px;
      position:relative;
    }
    
    .logo{
      width:72px;
      height:72px;
      border-radius:24px;
      background:linear-gradient(135deg, var(--primary-from), var(--primary-to));
      box-shadow: 0 20px 40px rgba(99,102,241,.3), inset 0 1px 0 rgba(255,255,255,.2);
      display:grid;
      place-items:center;
      color:#fff;
      font-weight:900;
      font-size:26px;
      letter-spacing:1px;
      position:relative;
      animation: logoFloat 3s ease-in-out infinite;
    }

    @keyframes logoFloat{
      0%, 100%{ transform: translateY(0px); }
      50%{ transform: translateY(-8px); }
    }

    .logo::after{
      content:'';
      position:absolute;
      inset:-4px;
      border-radius:26px;
      background:linear-gradient(135deg, var(--primary-from), var(--primary-to));
      opacity:.2;
      filter:blur(12px);
      z-index:-1;
    }

    .title{
      font-size:28px;
      font-weight:800;
      margin-bottom:8px;
      background:linear-gradient(135deg, var(--text), var(--text-muted));
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
      letter-spacing:-.5px;
    }

    .subtitle{
      font-size:14px;
      color:var(--text-muted);
      line-height:1.5;
      max-width:340px;
      margin:0 auto;
    }

    form{
      position:relative;
      z-index:1;
    }

    .field{
      margin-bottom:20px;
    }

    .label{
      display:flex;
      align-items:center;
      gap:6px;
      font-size:13px;
      font-weight:600;
      color:var(--text);
      margin-bottom:10px;
      letter-spacing:.2px;
    }

    .label svg{
      width:14px;
      height:14px;
      opacity:.7;
    }

    .input-wrapper{
      position:relative;
    }

    .input-icon{
      position:absolute;
      left:16px;
      top:50%;
      transform:translateY(-50%);
      width:20px;
      height:20px;
      color:var(--text-muted);
      pointer-events:none;
      transition: all .3s ease;
    }

    input{
      width:100%;
      padding:16px 16px 16px 48px;
      border-radius:16px;
      border:1.5px solid var(--input-border);
      background:var(--input-bg);
      color:var(--text);
      font-size:15px;
      font-family:inherit;
      outline:none;
      transition: all .3s cubic-bezier(.4,0,.2,1);
      backdrop-filter:blur(10px);
      -webkit-backdrop-filter:blur(10px);
    }

    input::placeholder{
      color:var(--text-muted);
      opacity:.6;
    }

    input:focus{
      border-color:var(--primary-from);
      background:var(--input-bg);
      box-shadow: 0 0 0 4px var(--input-focus), 0 8px 16px rgba(0,0,0,.1);
      transform:translateY(-2px);
    }

    input:focus + .input-icon{
      color:var(--primary-from);
      transform:translateY(-50%) scale(1.1);
    }

    .btn{
      width:100%;
      padding:16px 24px;
      border-radius:16px;
      border:none;
      background:linear-gradient(135deg, var(--primary-from), var(--primary-to));
      color:#fff;
      font-size:15px;
      font-weight:700;
      font-family:inherit;
      cursor:pointer;
      box-shadow: 0 12px 24px rgba(99,102,241,.3);
      position:relative;
      overflow:hidden;
      transition: all .3s cubic-bezier(.4,0,.2,1);
      letter-spacing:.3px;
    }

    .btn::before{
      content:'';
      position:absolute;
      inset:0;
      background:linear-gradient(135deg, rgba(255,255,255,.2), transparent);
      opacity:0;
      transition:opacity .3s ease;
    }

    .btn:hover{
      transform:translateY(-3px);
      box-shadow: 0 16px 32px rgba(99,102,241,.4);
    }

    .btn:hover::before{
      opacity:1;
    }

    .btn:active{
      transform:translateY(-1px);
    }

    .btn:disabled{
      opacity:.6;
      cursor:not-allowed;
      transform:none;
    }

    .btn-loader{
      display:inline-block;
      width:16px;
      height:16px;
      border:2px solid rgba(255,255,255,.3);
      border-top-color:#fff;
      border-radius:50%;
      animation:spin .6s linear infinite;
      margin-left:8px;
      vertical-align:middle;
    }

    @keyframes spin{
      to{ transform:rotate(360deg); }
    }

    .message{
      margin-top:20px;
      padding:14px 18px;
      border-radius:14px;
      font-size:13px;
      font-weight:500;
      display:none;
      align-items:center;
      gap:10px;
      animation: messageSlide .4s cubic-bezier(.34,1.56,.64,1);
    }

    @keyframes messageSlide{
      from{
        opacity:0;
        transform:translateY(-10px);
      }
      to{
        opacity:1;
        transform:translateY(0);
      }
    }

    .message.success{
      display:flex;
      background:rgba(16,185,129,.1);
      border:1px solid rgba(16,185,129,.3);
      color:var(--success);
    }

    .message.error{
      display:flex;
      background:rgba(239,68,68,.1);
      border:1px solid rgba(239,68,68,.3);
      color:var(--danger);
    }

    .message svg{
      width:18px;
      height:18px;
      flex-shrink:0;
    }

    .footer{
      margin-top:24px;
      padding-top:24px;
      border-top:1px solid var(--card-border);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }

    .status-badge{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding:8px 14px;
      border-radius:100px;
      background:var(--input-bg);
      border:1px solid var(--input-border);
      font-size:12px;
      font-weight:600;
      color:var(--text-muted);
      backdrop-filter:blur(10px);
      -webkit-backdrop-filter:blur(10px);
      transition: all .3s ease;
    }

    .status-badge:hover{
      transform:translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,.1);
    }

    .status-dot{
      width:8px;
      height:8px;
      border-radius:50%;
      background:#6b7280;
      position:relative;
    }

    .status-dot.online{
      background:var(--success);
      box-shadow: 0 0 0 3px rgba(16,185,129,.2);
      animation: pulse 2s ease infinite;
    }

    .status-dot.offline{
      background:var(--danger);
    }

    @keyframes pulse{
      0%, 100%{ opacity:1; }
      50%{ opacity:.5; }
    }

    @media (max-width: 480px){
      .card{
        padding:32px 24px;
        border-radius:28px;
      }
      .title{
        font-size:24px;
      }
      .subtitle{
        font-size:13px;
      }
      .logo{
        width:64px;
        height:64px;
        font-size:22px;
      }
      .theme-toggle{
        top:-56px;
        scale:.9;
      }
    }

    @media (prefers-reduced-motion: reduce){
      *{
        animation-duration: .01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: .01ms !important;
      }
    }
  </style>
</head>
<body data-theme="dark">
  <!-- Background elements -->
  <div class="bg-gradient"></div>
  <div class="orb o1"></div>
  <div class="orb o2"></div>
  <div class="orb o3"></div>
  <div class="grid-overlay"></div>

  <div class="container">
    <!-- Theme toggle -->
    <div class="theme-toggle" id="themeToggle">
      <button class="theme-btn active" data-theme="dark">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
        </svg>
      </button>
      <button class="theme-btn" data-theme="light">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="5"/>
          <path d="M12 1v2m0 18v2M4.22 4.22l1.42 1.42m12.72 12.72 1.42 1.42M1 12h2m18 0h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
        </svg>
      </button>
    </div>

    <div class="card">
      <div class="header">
        <div class="logo-wrapper">
          <div class="logo">MM</div>
        </div>
        <h1 class="title">Welcome Back</h1>
        <p class="subtitle">Enter your credentials to access the webmail portal</p>
      </div>

      <form id="loginForm">
        <div class="field">
          <label class="label">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
              <circle cx="12" cy="7" r="4"/>
            </svg>
            Email / Username
          </label>
          <div class="input-wrapper">
            <input 
              id="username" 
              type="text"
              autocomplete="username" 
              placeholder="john@yourdomain.com" 
              required 
            />
            <svg class="input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
              <path d="m22 6-10 7L2 6"/>
            </svg>
          </div>
        </div>

        <div class="field">
          <label class="label">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
              <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
            </svg>
            Password
          </label>
          <div class="input-wrapper">
            <input 
              id="password" 
              type="password" 
              autocomplete="current-password" 
              placeholder="••••••••••" 
              required 
            />
            <svg class="input-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
              <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
            </svg>
          </div>
        </div>

        <button id="submitBtn" class="btn" type="submit">
          <span id="btnText">Sign In</span>
        </button>

        <div id="message" class="message"></div>

        <div class="footer">
          <div class="status-badge">
            <span id="statusDot" class="status-dot"></span>
            <span id="statusText">Checking...</span>
          </div>
          <div style="font-size:11px;color:var(--text-muted);">v2.0</div>
        </div>
      </form>
    </div>
  </div>

  <script>
    // Theme toggle
    const themeToggle = document.getElementById('themeToggle');
    const body = document.body;
    const themeButtons = themeToggle.querySelectorAll('.theme-btn');

    themeButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        const theme = btn.dataset.theme;
        body.setAttribute('data-theme', theme);
        themeButtons.forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        localStorage.setItem('theme', theme);
      });
    });

    // Load saved theme
    const savedTheme = localStorage.getItem('theme') || 'dark';
    body.setAttribute('data-theme', savedTheme);
    themeButtons.forEach(btn => {
      btn.classList.toggle('active', btn.dataset.theme === savedTheme);
    });

    // Form elements
    const form = document.getElementById('loginForm');
    const submitBtn = document.getElementById('submitBtn');
    const btnText = document.getElementById('btnText');
    const message = document.getElementById('message');
    const statusDot = document.getElementById('statusDot');
    const statusText = document.getElementById('statusText');

    function showMessage(type, text, icon) {
      message.className = `message ${type}`;
      message.innerHTML = `
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          ${icon}
        </svg>
        <span>${text}</span>
      `;
      message.style.display = 'flex';
    }

    function hideMessage() {
      message.style.display = 'none';
    }

    // Health check
    async function checkHealth() {
      try {
        const response = await fetch('/api/health');
        const data = await response.json();
        const isOnline = data && data.status === 'ok';
        
        statusDot.className = `status-dot ${isOnline ? 'online' : 'offline'}`;
        statusText.textContent = isOnline ? 'API Online' : 'API Offline';
      } catch (error) {
        statusDot.className = 'status-dot offline';
        statusText.textContent = 'API Offline';
      }
    }

    // Form submission
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      hideMessage();
      
      const username = document.getElementById('username').value.trim();
      const password = document.getElementById('password').value;

      // Disable button and show loading
      submitBtn.disabled = true;
      btnText.innerHTML = 'Processing<span class="btn-loader"></span>';

      try {
        const response = await fetch('/api/login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username, password })
        });

        const data = await response.json().catch(() => ({}));
        
        if (!response.ok) {
          throw new Error(data.error || `HTTP ${response.status}`);
        }

        showMessage('success', 'Login successful! Redirecting...', `
          <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
          <polyline points="22 4 12 14.01 9 11.01"/>
        `);

        setTimeout(() => {
            window.location.replace(data.handoffUrl);
        }, 1000);

      } catch (error) {
        showMessage('error', error.message || 'Login failed. Please try again.', `
          <circle cx="12" cy="12" r="10"/>
          <path d="M15 9l-6 6m0-6l6 6"/>
        `);
      } finally {
        submitBtn.disabled = false;
        btnText.textContent = 'Sign In';
      }
    });

    // Input animations
    const inputs = document.querySelectorAll('input');
    inputs.forEach(input => {
      input.addEventListener('focus', () => {
        input.parentElement.classList.add('focused');
      });
      input.addEventListener('blur', () => {
        input.parentElement.classList.remove('focused');
      });
    });

    // Initial health check
    checkHealth();
    setInterval(checkHealth, 30000); // Check every 30 seconds
  </script>
</body>
</html>